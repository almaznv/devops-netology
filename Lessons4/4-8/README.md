
1. Подготовить инвентарь kubespray  
a) Созданы: 1 control plain нода, 2 worker ноды в YC  
b) Сгенерирован hosts.yml:  
```yaml
all:
  hosts:
    cp1:
      ansible_host: 51.250.25.87
      ansible_user: avagapov
    node1:
      ansible_host: 62.84.121.236
      ansible_user: avagapov
    node2:
      ansible_host: 51.250.22.209
      ansible_user: avagapov
  children:
    kube_control_plane:
      hosts:
        cp1:
    kube_node:
      hosts:
        node1:
        node2:
    etcd:
      hosts:
        cp1:
    k8s_cluster:
      children:
        kube_control_plane:
        kube_node:
    calico_rr:
      hosts: {}
```
c) Изменены настройки в k8s-cluster.yml
```yaml
supplementary_addresses_in_ssl_keys: [51.250.25.87]
```
CRI уже установлен в containerd:
````yaml
container_manager: containerd
````
d) Запущен playbook:
```shell
avagapov@local: ansible-playbook -i inventory/mycluster/hosts.yaml cluster.yml -b -v
.......
PLAY RECAP ******************************************************************************************************************************************************************************************************************************************************************************************************************
cp1                        : ok=750  changed=143  unreachable=0    failed=0    skipped=1250 rescued=0    ignored=9
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
node1                      : ok=497  changed=93   unreachable=0    failed=0    skipped=739  rescued=0    ignored=2
node2                      : ok=497  changed=93   unreachable=0    failed=0    skipped=738  rescued=0    ignored=2

Sunday 31 July 2022  20:36:45 +0300 (0:00:00.084)       0:29:35.757 ***********
===============================================================================
kubernetes-apps/ansible : Kubernetes Apps | Lay Down CoreDNS templates ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 62.96s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 58.98s
network_plugin/calico : Wait for calico kubeconfig to be created ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 49.46s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 41.00s
download : download_file | Validate mirrors ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 40.80s
kubernetes/preinstall : Install packages requirements --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 40.51s
network_plugin/calico : Calico | Create calico manifests ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 37.13s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 34.62s
kubernetes/control-plane : kubeadm | Initialize first master -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 33.88s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 29.07s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 25.78s
bootstrap-os : Install dbus for the hostname module ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 24.30s
kubernetes-apps/ansible : Kubernetes Apps | Start Resources --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 22.90s
kubernetes/kubeadm : Join to cluster -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 21.05s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 19.88s
kubernetes-apps/ansible : Kubernetes Apps | Lay Down nodelocaldns Template ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 18.67s
download : download_container | Download image if required ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 16.28s
network_plugin/calico : Get current calico cluster version ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 14.60s
kubernetes/preinstall : Update package management cache (APT) ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 14.42s
network_plugin/calico : Get current calico cluster version ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 14.32s


avagapov@local: kubectl get pods --all-namespaces
NAMESPACE     NAME                              READY   STATUS    RESTARTS      AGE
kube-system   calico-node-pzhzx                 1/1     Running   0             19m
kube-system   calico-node-xh7df                 1/1     Running   0             19m
kube-system   calico-node-zdr2g                 1/1     Running   0             19m
kube-system   coredns-74d6c5659f-mjzb4          1/1     Running   0             16m
kube-system   coredns-74d6c5659f-wgsz8          1/1     Running   0             16m
kube-system   dns-autoscaler-59b8867c86-4wlm6   1/1     Running   0             16m
kube-system   kube-apiserver-cp1                1/1     Running   1             23m
kube-system   kube-controller-manager-cp1       1/1     Running   1             23m
kube-system   kube-proxy-586nf                  1/1     Running   0             21m
kube-system   kube-proxy-8zr7t                  1/1     Running   0             21m
kube-system   kube-proxy-wf6vb                  1/1     Running   0             21m
kube-system   kube-scheduler-cp1                1/1     Running   2 (19m ago)   23m
kube-system   nginx-proxy-node1                 1/1     Running   0             20m
kube-system   nginx-proxy-node2                 1/1     Running   0             19m
kube-system   nodelocaldns-9s7w8                1/1     Running   0             16m
kube-system   nodelocaldns-lbr6c                1/1     Running   0             16m
kube-system   nodelocaldns-xv5zt                1/1     Running   0             16m
```